# RDS

**対象：SFDC用リレーショナルデータベース**

---

# 【現行調査】

RDSはSDFC用に追加になるコンポーネントのため、現状の取得しているログはなし

---

# 【追加分】（今回の要求で必須）

- 「誰が・いつ・どのDB構成を変更したか」を証跡として残す
- 不正な設定変更・削除を検知可能にする

## 1. RDS 管理イベント（CloudTrail） | デフォルトで取得

| アクション                                          | 説明                     |
| --------------------------------------------------- | ------------------------ |
| CreateDBInstance / DeleteDBInstance                 | DBインスタンス作成・削除 |
| ModifyDBInstance                                    | インスタンス設定変更     |
| CreateDBCluster / ModifyDBCluster / DeleteDBCluster | Aurora クラスター操作    |
| CreateDBSnapshot / DeleteDBSnapshot                 | スナップショット操作     |
| RestoreDBInstanceFromSnapshot                       | スナップショット復元     |
| ModifyDBParameterGroup                              | パラメータ変更           |
| AddTagsToResource / RemoveTagsFromResource          | タグ操作                 |

## 2. RDS データプレーン操作（DB内操作） | 追加で取得

### PostgreSQL / Aurora PostgreSQL

| ログ                                 | 内容                          |
| ------------------------------------ | ----------------------------- |
| log_connections / log_disconnections | ログイン/ログアウト           |
| log_statement                        | SQL実行履歴                   |
| pgaudit                              | SELECT/INSERT/UPDATE/DDL 監査 |

---

## 3. CloudWatch メトリクス（異常検知） | デフォルトで取得

**目的：**

- 監査ログの「補助線」
- 不正アクセス・異常負荷の兆候検知

| メトリクス           | 用途             |
| -------------------- | ---------------- |
| DatabaseConnections  | 不審な接続増加   |
| CPUUtilization       | 異常負荷         |
| FreeableMemory       | リソース枯渇     |
| ReadIOPS / WriteIOPS | 想定外の大量操作 |

---

## 4. イベント通知 | 追加設定が必要

データ操作発生時にリアルタイムで通知を送信。以下の送信先に対応。

---

- 参考ドキュメント：
  - [RDS 管理イベント（CloudTrail）](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/logging-using-cloudtrail.html)
  - [RDS Event Notifications](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_Events.html)
  - [RDS データベース監査ログ（PostgreSQL）](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Appendix.PostgreSQL.CommonDBATasks.html#Appendix.PostgreSQL.CommonDBATasks.Auditing)
  - [RDS CloudWatch メトリクス](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/monitoring-cloudwatch.html)

<!--
### 通知設定

| 設定項目       | 推奨内容                                                                   |
| -------------- | -------------------------------------------------------------------------- |
| 送信先         | SNS トピック → Lambda → Slack                                              |
| 通知先         | `bs-notification-dev/stg/prd`（Slack）                                     |
| 対象イベント   | deletion, configuration change, security, failure, backup failure を最優先 |
| フィルタリング | 重要度の高いイベントのみに絞る（運用負荷軽減）                             |

### 監査証跡として記録される情報

| 項目         | 内容                                                    |
| ------------ | ------------------------------------------------------- |
| イベント時刻 | UTC形式のタイムスタンプ                                 |
| イベント種別 | deletion, configuration change, backup failure等        |
| 対象リソース | DBインスタンス識別子、スナップショット名                |
| イベント詳細 | 変更内容、エラーメッセージ、フェイルオーバー理由等      |
| 発生元       | AWS RDSサービス（人的操作はCloudTrailで別途記録される） |

### CloudTrailとの使い分け

| 観点               | CloudTrail管理イベント     | RDS Event Notifications        |
| ------------------ | -------------------------- | ------------------------------ |
| **取得内容**       | 誰が・いつ・何を実行したか | DBの状態変化・障害発生         |
| **通知タイミング** | 後から分析（5〜15分遅延）  | リアルタイム（秒〜分単位）     |
| **用途**           | 監査証跡・コンプライアンス | 即時対応・インシデント検知     |
| **記録内容**       | API呼び出し・IAMユーザー   | DBインスタンス状態・エラー詳細 |

### 補足

- **CloudTrail**: 「誰が削除したか」を証跡として記録
- **RDS Event Notifications**: 「DBが削除された」ことをリアルタイムで通知

**両方を併用することで、監査証跡の完全性とインシデント対応の迅速性を両立できる。** -->
<!--
**目的：**

- DB構成・状態変更のリアルタイム検知
- 不正なDB削除・設定変更の即時通知
- バックアップ失敗・フェイルオーバー等の障害検知

DB構成変更や障害発生時にリアルタイムで通知を送信。SNS経由でSlackに連携可能。

### 対応イベントカテゴリ

| イベントカテゴリ         | 説明                                                 | カバーするリスク          | 通知 |
| ------------------------ | ---------------------------------------------------- | ------------------------- | ---- |
| **availability**         | DBインスタンスの停止・起動・再起動・フェイルオーバー | インシデント対応遅れ（Ⅴ） | ◎    |
| **backup**               | バックアップ開始・完了・失敗・復元                   | 証跡改ざん対策（Ⅴ）       | ◎    |
| **configuration change** | DBインスタンス・パラメータグループの設定変更         | 内部不正（Ⅴ）             | ◎    |
| **creation**             | DBインスタンス・スナップショットの作成               | 内部不正（Ⅴ）             | ○    |
| **deletion**             | DBインスタンス・スナップショットの削除               | 内部不正（Ⅴ）             | ◎    |
| **failover**             | Multi-AZ フェイルオーバーの開始・完了                | インシデント対応遅れ（Ⅴ） | ◎    |
| **failure**              | DBインスタンスの障害                                 | インシデント対応遅れ（Ⅴ） | ◎    |
| **low storage**          | ストレージ容量の逼迫                                 | システム障害検知          | ◎    |
| **maintenance**          | メンテナンスの開始・完了・必要性                     | 運用追跡                  | ○    |
| **notification**         | DBインスタンスが通知を必要とする状態になった         | インシデント対応遅れ（Ⅴ） | ○    |
| **recovery**             | Point-in-time リカバリの開始・完了                   | 証跡改ざん対策（Ⅴ）       | ◎    |
| **restoration**          | バックアップからの復元開始・完了                     | 証跡改ざん対策（Ⅴ）       | ◎    |
| **security**             | セキュリティグループの変更                           | 不正侵入（Ⅱ）             | ◎    | -->
